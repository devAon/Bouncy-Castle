[
ê³ ë ¤ëŒ€ í”„ë¡œì íŠ¸ ì•”í˜¸í™” - ê³µê°œí‚¤, ë¹„ë°€í‚¤, Bouncy Castle, í”„ë¡œì íŠ¸ê°œìš”, CryptoHelper ì½”ë“œ](https://aonee.tistory.com/manage/newpost/37?type=post&returnURL=https%3A%2F%2Faonee.tistory.com%2Fentry%2F%25EA%25B3%25A0%25EB%25A0%25A4%25EB%258C%2580-%25ED%2594%2584%25EB%25A1%259C%25EC%25A0%259D%25ED%258A%25B8-%25EC%2595%2594%25ED%2598%25B8%25ED%2599%2594)


### **ğŸ”¥ëª©ì°¨*ğŸ”¥***

***ğŸ“* 1. ê³µê°œí‚¤(=ë¹„ëŒ€ì¹­í‚¤) - RSA, ECDSA**

***ğŸ“* 2. ë¹„ë°€í‚¤(=ëŒ€ì¹­í‚¤) -AES**

***ğŸ“* 3. Bouncy Castle, ì¸ì¦ì„œ**

***ğŸ“* 4. í”„ë¡œì íŠ¸ ê°œìš”**

***ğŸ“* 5. CS ê°œë°œì— í•„ìš”í•œ CryptoHelper ì½”ë“œ**
        
         
           
          
           
           
### ***ğŸ“ 1.* ê³µê°œí‚¤(=ë¹„ëŒ€ì¹­í‚¤) - RSA, ECDSA**

ê³µê°œí‚¤, ê°œì¸í‚¤

**ê³µê°œí‚¤** : **ì „ì†¡ì**ê°€ ì •ë³´ **ì•”í˜¸í™”**í•˜ëŠ”ë° ì‚¬ìš©**

**ê°œì¸í‚¤** : **ìˆ˜ì‹ ì**ê°€ ì•”í˜¸ **í•´ë…**ì— ì‚¬ìš©

ëˆ„êµ¬ë‚˜ ì•”í˜¸í™”ëŠ” ê°€ëŠ¥í•˜ë‹¤. ê·¸ëŸ¬ë‚˜ ê°œì¸í‚¤ë¥¼ ê°€ì§„ ì‚¬ëŒë§Œ í•´ë…ì´ ê°€ëŠ¥í•˜ë‹¤.



![img](https://k.kakaocdn.net/dn/cBaD66/btqC7rG0ptI/7BjvjJtCqWxfqx6YkkyPbk/img.png)

**RSA : ì•”í˜¸í™”, ì „ìì„œëª…**

**ECDSA** : Elliptic Curve Digital Signature Algorithm (ê¸°ë³¸ ì„œëª…, ì•”í˜¸í™”)

**ECIES** : Elliptic Curve Integrated Encryption scheme (ê³µìœ  ëŒ€ì¹­í‚¤ ìƒì„±)





**( ê´€ë ¨ í¬ìŠ¤íŒ… )**
[
ê³µê°œí‚¤ ì•”í˜¸ ì‹œìŠ¤í…œ, ê°œì¸í‚¤ ì•”í˜¸ ì‹œìŠ¤í…œê³µê°œí‚¤ (= ë¹„ëŒ€ì¹­í‚¤)](https://aonee.tistory.com/entry/ê³µê°œí‚¤-ì•”í˜¸-ì‹œìŠ¤í…œ-ê°œì¸í‚¤-ì•”í˜¸-ì‹œìŠ¤í…œ)








### ***ğŸ“ 2.* ë¹„ë°€í‚¤(=ëŒ€ì¹­í‚¤) - AES**

ì•”í˜¸í™”ì™€ ë³µí˜¸í™”ì— ê°™ì€ ì•”í˜¸í‚¤ë¥¼ ì“°ëŠ” ì•Œê³ ë¦¬ì¦˜ì„ ì˜ë¯¸í•œë‹¤.

![img](https://k.kakaocdn.net/dn/bOcjnW/btqC8HJj01G/bMQYpBBhfOGBe1hd6iO2Gk/img.png)



**ì¥ì **

1. í‚¤ í¬ê¸°ê°€ ìƒëŒ€ì ìœ¼ë¡œ ì‘ê³  ì•”í˜¸ ì•Œê³ ë¦¬ì¦˜ ë‚´ë¶€ êµ¬ì¡°ê°€ ë‹¨ìˆœí•˜ë‹¤.

2. ì‹œìŠ¤í…œ ê°œë°œ í™˜ê²½ì— ìš©ì´í•˜ë‹¤.

3. ë¹„ëŒ€ì¹­í‚¤ì— ë¹„í•´ ì•”í˜¸í™”ì™€ ë³µí˜¸í™” ì†ë„ê°€ ë¹ ë¥´ë‹¤



**ë‹¨ì **

1. êµí™˜ ë‹¹ì‚¬ìê°„ì— ë™ì¼í•œ í‚¤ë¥¼ ê³µìœ í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— í‚¤ê´€ë¦¬ì˜ ì–´ë ¤ì›€ì´ ìˆê³ 

2. ì¦ì€ í‚¤ ë³€ê²½ì´ ìˆëŠ” ê²½ìš°ì— ë¶ˆí¸í•¨ì„ ì´ˆë˜í•œë‹¤. 

3. ë””ì§€í„¸ ì„œëª… ê¸°ë²•ì— ì ìš©ì´ ê³¤ë€í•˜ê³  ì•ˆì „ì„±ì„ ë¶„ì„í•˜ê¸°ê°€ ì–´ë µê³  ì¤‘ì¬ìê°€ í•„ìš”í•˜ë‹¤.



### ***ğŸ“ 3.*  Bouncy Castle, ì¸ì¦ì„œ\*\*\*\*\*\**\***

**Bouncy Castle ì´ë€?**

ìë°”ì•”í˜¸ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤.

Javaì—ì„œ íƒ€ì› ê³¡ì„  ì•”í˜¸í™” ê¸°ìˆ ì„ ì‰½ê²Œ ì´ìš© ê°€ëŠ¥í•˜ë„ë¡ í•´ì¤€ë‹¤.



**eclipse ì—ì„œ library ì¶”ê°€ ë°©ë²•**

1. widow - preferences - Java - Build Path - User Libraries

  ì—¬ê¸°ì„œ New - libraryëª… ë‚´ê°€ ì›í•˜ëŠ”ëŒ€ë¡œ ì ê³  ok - apply and close

2. project ìš°í´ë¦­ - build path - add libraries - User Library - ë‚´ê°€ ë§Œë“  ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„ íƒ - Finish





**intellij ì—ì„œ \**library ì¶”ê°€ ë°©ë²•\****

```
<!-- https://mvnrepository.com/artifact/org.bouncycastle/bcpkix-jdk15on -->
        <dependency>
            <groupId>org.bouncycastle</groupId>
            <artifactId>bcpkix-jdk15on</artifactId>
            <version>1.60</version>
        </dependency>
```





**ì¸ì¦ì„œ ë€?** 

ì»´í“¨í„°ì— ì €ì¥ëœ ê°œì¸í‚¤/ê³µê°œí‚¤ íŒŒì¼

- ì¼ë°˜ì ìœ¼ë¡œ ì¸ì¦ì„œ ì •ë³´ëŠ” byte í˜•íƒœë¡œ ì €ì¥ë˜ì–´ìˆì–´ ì½ê±°ë‚˜ ì²˜ë¦¬ê°€ ì–´ë ¤ìš°ë¯€ë¡œ í‚¤ ë°ì´í„°ë¥¼ Base64 ì•Œê³ ë¦¬ì¦˜ì„ ì´ìš©í•´ ì‚¬ìš©í•˜ê¸° ì‰¬ìš´ í˜•íƒœë¡œ ì¸ì½”ë”© í•´ì„œ ê´€ë¦¬í•¨
- PEM(Privacy Enhanced Mail) : ì¸ì½”ë”©ëœ íŒŒì¼ .pem í™•ì¥ì



### **ğŸ“ 4. í”„ë¡œì íŠ¸ ê°œìš”** 



![img](https://k.kakaocdn.net/dn/ceEJgN/btqC781tlvn/YGqlNs2bcoK1kNjRryLBL0/img.png)



**cdm ê³µí†µë°ì´í„° ëª¨ë¸ :** ì§„ë£Œê¸°ë¡ì„ ë™ì¼í•œ í¬ë§·ìœ¼ë¡œ í†µì¼í•˜ì—¬ ì—°êµ¬ì— í™œìš©.

**ê°œë°œ ëª©í‘œ :** ë³´ì•ˆì ìœ¼ë¡œ ì•ˆì „í•œ cdm ë°ì´í„° ë¶„ì„ í”Œë«í¼ ì„¤ê³„ ë° ê°œë°œ

**WI :** í´ë¼ì´ì–¸íŠ¸ í”„ë¡œê·¸ë¨.

**AS** : ë¡œê·¸ì¸ìš©.

**CS** : ë¶„ì„ì½”ë“œ & ë¬´ê²°ì„± ë³´ì¥ ì „ìì„œëª… ì¤€ë¹„

**TGS** : í‹°ì¼“ì¤€ë¹„.

**RS :** ì¤€ë¹„ëœ [ë¶„ì„ì½”ë“œ. ì „ìì„œëª…. í‹°ì¼“] ì„ SSì— ì „ë‹¬.



**ì‹œë‚˜ë¦¬ì˜¤**

\1. ì¤‘ê°„ì— ì—°êµ¬ë§ì„œë²„ë¥¼ ë‘ê³  ì—°êµ¬ë§ì„œë²„ì— ì—¬ëŸ¬ ëŒ€í•™ë³‘ì›ë“¤ì˜ ì„œë²„ê°€ ì—°ê²°ëœë‹¤.

\2. CDMë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ì‹¶ì€ ì—°êµ¬ìê°€ ì—°êµ¬ë§ì„œë²„ì— ë¶„ì„ì„ í•˜ê¸° ìœ„í•œ ì†ŒìŠ¤ì½”ë“œë¥¼ ì „ë‹¬í•˜ë©´

  ì—°êµ¬ë§ì„œë²„ê°€ ë‹¤ì‹œ ì—°ê²°ë˜ì–´ ìˆëŠ” ê° ëŒ€í•™ë³‘ì›ì˜ ì„œë²„ìª½ìœ¼ë¡œ ë¶„ì„ì½”ë“œë¥¼ ì­‰ ë¶„í•´ë¥¼ í•œë‹¤.

\3. ëŒ€í•™ë³‘ì›ì— ìˆëŠ” ì„œë²„ëŠ” ë¶„ì„ì½”ë“œë¥¼ ë°›ì•„ ì‹¤í–‰ì„ í•˜ê³  ë¶„ì„ëœ ê²°ê³¼ë¥¼

   ë‹¤ì‹œ ì—°êµ¬ë§ì„œë²„ë¡œ íšŒì‹ í•´ì£¼ë©´

   ì—°êµ¬ìê°€ ì—°êµ¬ë§ì„œë²„ì— ëª¨ì—¬ìˆëŠ” ë¶„ì„ê²°ê³¼ë¥¼ ê°€ì ¸ê°€ëŠ” ë°©ì‹ì´ë‹¤.



### ***ğŸ“ 5.* CS ê°œë°œì— í•„ìš”í•œ CryptoHelper ì½”ë“œ**

**CS (Code Signer) : ë¶„ì„ì½”ë“œ & ë¬´ê²°ì„± ë³´ì¥ ì „ìì„œëª… ì¤€ë¹„**

ë¶„ì„ì½”ë“œë¥¼ ì—°êµ¬ìê°€ ì—°êµ¬ë§ì„œë²„ë¡œ ì—…ë¡œë“œë¥¼ í•˜ëŠ”ë°,

ê·¸ ë¶„ì„ì½”ë“œê°€ ë„¤íŠ¸ì›Œí¬ë¥¼ íƒ€ê³  ë‹¤ì‹œ ëŒ€í•™ë³‘ì›ì— ì „ë‹¬ëœë‹¤.

ì´ë•Œ ì¤‘ê°„ì— ë°ì´í„° ë³€ì¡°ê°€ ì¼ì–´ë‚˜ì§€ ì•Šë„ë¡ (=ë°ì´í„° ë¬´ê²°ì„±ì„ ì§€í‚¬ ìˆ˜ ìˆë„ë¡)

ì „ìì„œëª…ì„ ì¶”ê°€í•´ì£¼ëŠ” ì—­í• ì„ í•œë‹¤.



![img](https://k.kakaocdn.net/dn/bW0UVV/btqC491rYNr/Gk6FCeMw0yr5qZe4PR3900/img.png)

**âœ” (3) C -> CS : ê²€ì¦ì„ ìœ„í•œ ë³µí˜¸í™”**


**â‘  Sig2C ê²€ì¦** 
\- signature, cpk ì´ìš©í•´ì„œ ë°œì‹ ì¸ì´ Cë¼ëŠ” ê²ƒì„ í™•ì¸ 
\- http://www.bitweb.co.kr/m/view.php?idx=921 
 

 **â‘  -1) Clientë¡œë¶€í„° PK+ íšë“** 
  \- Base64 Decoding : ê³µê°œí‚¤ë¥¼ Base64 Decoding
  \- Decodingí•œ PK+(ê³µê°œí‚¤)ë¥¼ ë‹¤ì‹œ Public Key í˜•íƒœë¡œ ë³€ê²½

 **â‘  -2) Signature Base64 Decoding**

  \- Signature íšë“ 
  \- Signatureë¥¼ Base64 Decoding 
  \- JSON Body ìì²´ë¥¼ toString()í™” í•´ì„œ

  \- verify(cpkPublicKey, decodedSignature, Body); ìˆ˜í–‰
    Jackson ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©     

```
<dependency>
    <groupId>com.fasterxml.jackson.core</groupId>
    <artifactId>jackson-databind</artifactId>
    <version>2.8.8</version>
</dependency>
```



 **â‘  -3) ECDSA PK+(Signature)** 


**â‘¡ sk ë³µí˜¸í™”** 
\- í˜„ì¬ëŠ” ì—†ê¸° ë•Œë¬¸ì— SKIP 

**â‘¢ í‹°ì¼“ ë³µí˜¸í™”** 
\- ticket 
 \- cname 
 \- institution 
 \- time 
  \- from 
  \- to 
\1. í‹°ì¼“ì˜ ìœ íš¨ê¸°ê°„ í™•ì¸ 
\2. í‹°ì¼“ì˜ cname, institution í™•ì¸







**âœ” (4) CS -> C : ê²€ì¦ì„ ìœ„í•œ ë³µí˜¸í™”**


**â‘  TGS í‹°ì¼“ ë°œí–‰**

  **â‘  - 1)** Skë¥¼ ìƒì„±í•œë‹¤ (ë¹„ë°€í‚¤ ìƒì„±) 
  **â‘  - 2)** Skë¡œ IDc, Hospitalc, Time ì •ë³´ë¥¼ ì•”í˜¸í™”í•œë‹¤ 
  **â‘  - 3)** ì•”í˜¸í™”ëœ í…ìŠ¤í‹€ë¥¼ ë³´ë‚¸ë‹¤ 



**â‘¡ CS ECDSA ì„œëª…**

  **â‘¡ - 1)** TGSê³µê°œí‚¤ë¥¼ ìƒì„±í•œë‹¤ 
  **â‘¡ - 2)** (SK CS-TGS) ì •ë³´ë¥¼ ì•”í˜¸í™”í•œë‹¤



**â‘¢ AC \**ECDSA ì„œëª…\****

**â‘£ Cì—ê²Œ ì „ë‹¬í•  ë©”ì‹œì§€ JSON**



**(cryptoHelper ì „ì²´ì½”ë“œ)**

https://github.com/devAon/BouncyCastle/blob/master/src/CryptoHelper.java

[
devAon/BouncyCastleBouncy Castle Crypto APIs. Contribute to devAon/BouncyCastle development by creating an account on GitHub.github.com](https://github.com/devAon/BouncyCastle/blob/master/src/CryptoHelper.java)

**RSA**

```
private KeyPair generateRsaKeyPair() throws NoSuchAlgorithmException {
        KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance("RSA");
        keyPairGenerator.initialize(2048);
        KeyPair keyPair = keyPairGenerator.genKeyPair();
        return keyPair;
    }
```



**ECDSA**

```
private KeyPair generateEcKeyPair() throws NoSuchAlgorithmException, InvalidAlgorithmParameterException {
        Security.addProvider(new BouncyCastleProvider());
        ECParameterSpec ecSpec = ECNamedCurveTable.getParameterSpec("prime256v1");
        SecureRandom random = new SecureRandom();
        KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance("ECDSA");
        keyPairGenerator.initialize(ecSpec, random);
        KeyPair keyPair = keyPairGenerator.generateKeyPair();
        return keyPair;
    }
```



**í‚¤ìƒì„± í›„ íŒŒì¼ ì €ì¥**

```
private void writeToFile(File output, byte[] toWrite)
        throws IllegalBlockSizeException, BadPaddingException, IOException {
        FileOutputStream fos = new FileOutputStream(output);
        fos.write(toWrite);
        fos.flush();
        fos.close();
    }
```



**getPrivate**

```
 public PrivateKey getPrivate(String filename, String cryptoType) throws Exception {
        // cryptoType {RSA, EC}
        byte[] keyBytes = Files.readAllBytes(new File(filename).toPath());
        PKCS8EncodedKeySpec spec = new PKCS8EncodedKeySpec(keyBytes);
        KeyFactory kf = KeyFactory.getInstance(cryptoType);
        return kf.generatePrivate(spec);
    }
```



**getPublic**

```
public PublicKey getPublic(String filename, String cryptoType) throws Exception {
        // cryptoType {RSA, EC}
        byte[] keyBytes = Files.readAllBytes(new File(filename).toPath());
        X509EncodedKeySpec spec = new X509EncodedKeySpec(keyBytes);
        KeyFactory kf = KeyFactory.getInstance(cryptoType);
        return kf.generatePublic(spec);
    }
```



**getPrivate, getPublic ì‚¬ìš©**

```
if (!new File("CS-KeyPair/CS-PublicKey").exists() || !new File("CS-KeyPair/CS-PrivateKey").exists()) {
            KeyPair keyPair = null;
            keyPair = this.generateEcKeyPair();
            this.writeToFile(new File("CS-KeyPair/CS-PublicKey"), keyPair.getPublic().getEncoded());
            this.writeToFile(new File("CS-KeyPair/CS-PrivateKey"), keyPair.getPrivate().getEncoded());
        }
        
PublicKey publicKey = this.getPublic("CS-KeyPair/CS-PublicKey", "EC");
PrivateKey privateKey = this.getPrivate("CS-KeyPair/CS-PrivateKey", "EC");
```



**sign ì „ìì„œëª…**

```
public static byte[] sign(PrivateKey privateKey, byte[] ac) throws GeneralSecurityException {
        Signature signature = Signature.getInstance("SHA256withECDSA");
        signature.initSign(privateKey);
        signature.update(ac);

        byte[] signatureData = signature.sign();
        return signatureData;
    }
```



**SignAC** : Generate AC Signature using CS's ECDSA private key

```
public byte[] SignAC(String ac) throws Exception {
		// String cryptoType =
		// GlobalConfig.getInstance().getCertConfig().getCryptoType();

		if (!new File("CS-KeyPair").exists())
			new File("CS-KeyPair").mkdir();
		if (!new File("CS-KeyPair/CS-PublicKey").exists() || !new File("CS-KeyPair/CS-PrivateKey").exists()) {
			KeyPair keyPair = null;
			keyPair = this.generateEcKeyPair();
			this.writeToFile(new File("CS-KeyPair/CS-PublicKey"), keyPair.getPublic().getEncoded());
			this.writeToFile(new File("CS-KeyPair/CS-PrivateKey"), keyPair.getPrivate().getEncoded());
		}

		PublicKey publicKey = this.getPublic("CS-KeyPair/CS-PublicKey", "EC");
		PrivateKey privateKey = this.getPrivate("CS-KeyPair/CS-PrivateKey", "EC");

		Charset charset = Charset.forName("UTF-8");
		byte[] signature = sign(privateKey, ac.getBytes(charset));

		// return bytesToHex(signature);
		return signature;
	}
```



**getECPublicKey**

```
public byte[] getECPublicKey() throws Exception {
		PublicKey publicKey = this.getPublic("CS-KeyPair/CS-PublicKey", "EC");
		byte[] publicKeyBytes = publicKey.getEncoded();

		return publicKeyBytes;
	}
```





**EncryptRSA**

```
public String EncryptRSA(String ac) throws Exception {
		// String cryptoType =
		// GlobalConfig.getInstance().getCertConfig().getCryptoType();
		Cipher cipher = Cipher.getInstance("RSA");

		if (!new File("CS-KeyPair").exists())
			new File("CS-KeyPair").mkdir();
		if (!new File("CS-KeyPair/CS-PublicKey").exists() || !new File("CS-KeyPair/CS-PrivateKey").exists()) {
			KeyPair keyPair = null;
			keyPair = this.generateRsaKeyPair();
			this.writeToFile(new File("CS-KeyPair/CS-PublicKey"), keyPair.getPublic().getEncoded());
			this.writeToFile(new File("CS-KeyPair/CS-PrivateKey"), keyPair.getPrivate().getEncoded());
		}

		PublicKey publicKey = this.getPublic("CS-KeyPair/CS-PublicKey", "RSA");
		PrivateKey privateKey = this.getPrivate("CS-KeyPair/CS-PrivateKey", "RSA");

		cipher.init(Cipher.ENCRYPT_MODE, privateKey);
		Base64.Encoder encoder = Base64.getEncoder();

		return encoder.encodeToString(cipher.doFinal(ac.getBytes("UTF-8")));
	}
```



**SK cs-tgs ìƒì„±**

```
public SecretKey getSecretEncryptionKey() throws Exception {
		KeyGenerator generator = KeyGenerator.getInstance("AES"); // AES Key Generator ê°ì²´ ìƒì„±
		generator.init(128); // AES Key size ì§€ì •
		SecretKey secKey = generator.generateKey(); // AES ì•”í˜¸í™” ì•Œê³ ë¦¬ì¦˜ì—ì„œ ì‚¬ìš©

		return secKey;
	}
```



**CBC ì•”í˜¸í™”ë¥¼ ìœ„í•´ IV ìƒì„±**

```
public IvParameterSpec getIvParameterSpec() throws Exception {
		SecureRandom random = new SecureRandom();
		byte[] ivData = new byte[16]; // 128 bit
		random.nextBytes(ivData);
		IvParameterSpec ivParameterSpec = new IvParameterSpec(ivData);
		Charset charset = Charset.forName("UTF-8");

		return ivParameterSpec;
	}
```



**CBC ìš´ìš©ëª¨ë“œ AES ì•”í˜¸í™”**

```
public byte[] encrypt(SecretKey secretKey, IvParameterSpec ivParameterSpec, String plainData)
			throws GeneralSecurityException {
		Cipher cipher = Cipher.getInstance("AES/CBC/PKCS5Padding");
		cipher.init(Cipher.ENCRYPT_MODE, secretKey, ivParameterSpec);
		byte[] encryptData = cipher.doFinal(plainData.getBytes());

		return encryptData;
	}
```



**isSigVal** : ì „ìì„œëª… ê²€ì¦

```
public static boolean isSigVal(PublicKey publicKey, byte[] signatureData, byte[] plainData)
			throws GeneralSecurityException {
		Signature signature = Signature.getInstance("SHA256withECDSA");
		signature.initVerify(publicKey);
		signature.update(plainData);
		return signature.verify(signatureData);
	}
```





**isTicketVal** : í‹°ì¼“ ê²€ì¦

```
public static boolean isTicketVal(Map<String, Object> ticket, Map<String, Object> time) throws ParseException {
		SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
		SimpleDateFormat sdf2 = new SimpleDateFormat("yyyy-MM-dd HH:mm");
		Date ticketTime = sdf.parse((String) ticket.get("timestamp"));
		Date timeFrom = sdf2.parse((String) time.get("from"));
		Date timeTo = sdf2.parse((String) time.get("to"));

		if (ticketTime.after(timeFrom) && ticketTime.before(timeTo)) {
			return true;
		}
		return false;
	}
```







**convertStringToPK** : String dmf Public Keyë¡œ ë³€í™˜

```
public PublicKey convertStringToPK(String cpk) throws NoSuchAlgorithmException, InvalidKeySpecException {
		cpk = cpk.replaceAll("-----BEGIN PUBLIC KEY-----", "");
		cpk = cpk.replaceAll("-----END PUBLIC KEY-----", "");
		cpk = cpk.replaceAll(System.getProperty("line.separator"), "");

		// CPK Base64 Decode
		byte[] decodedCpk = org.bouncycastle.util.encoders.Base64.decode(cpk);

		X509EncodedKeySpec spec = new X509EncodedKeySpec(decodedCpk);
		KeyFactory kf = KeyFactory.getInstance("EC");
		PublicKey cpkPublicKey = kf.generatePublic(spec);

		return cpkPublicKey;
	}
```
